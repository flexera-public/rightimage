= DESCRIPTION:

Builds a RightImage on a loopback filesystem.  Creates base OS install and common utils then adds the cloud specific settings.  Also has the ability to upload and register the RightImage with corresponding cloud.


= CONVENTIONS:

"base" recipes clean the base image and install RightLink.

"bootstrap" recipes install a vanilla base image.

"cloud" recipes add cloud specific settings to the guest image.

"upload" recipes convert the raw guest image and upload to the cloud. 


= USAGE:

ServerTemplate: 

Use the latest version of right_image_creator.

Image:

Select an image that matches the target guest platform:
  * Centos 5.6 x64 builds x64 guest
  * Centos 5.6 i386 builds i386 guest
  * Ubuntu x64 builds both x64 and i386 guests

Inputs:

  Build mode::
    base: Creates a new base OS image.
    full: Creates a full image with cloud-specific modifications and RightLink.
    migrate: Downloads an already bundled image from EC2 S3 in order to replicate it across other EC2 regions.
  Build number::
    Starts at 0.  Creates a lineage of base snapshots derived from the same day.
  Build timestamp and mirror freeze date::
    Specified in the format of YYYYMMDDHHMM (Year, month, day, 24 hour time)
    Used to derive the lineage name and to set the software mirror freeze date.
  Manual mode::
    true: Do nothing on boot; allows for running recipes by hand.
    false: In base mode, build a base image.  In full mode, build an image but don't upload.
  Debug::
    true: Enables random root password login on image. 
    password is appended to end of image name.
    false: Password login via SSH is disabled.  SSH key auth only.
  Image name::
    Image name (must contain "Dev" if debug == true)
  Hypervisor::
    Set to the appropriate hypervisor type for the cloud.
    esxi::
      cloudstack
    kvm::
      openstack, cloudstack
    xen::
      ec2, eucalyptus, cloudstack
    
    

== Building a base OS image (Build mode: base, Manual mode: false):

Automatic mode is useful when building a base image on boot

  1. Set ‘build mode’ to base and ‘manual mode’ to false
  2. launch server

== Building a base OS image (Build mode: base, Manual mode: true):

Manual mode is useful when developing of the rightimage cookbooks

  1. Set ‘build mode’ to base and ‘manual mode’ to true
  2. launch server
  3. once operational start the build using "rightimage::build_base" recipe

== Building a RightImage (Build mode: full, Manual mode: false):

Automatic mode is useful when building an image on boot

  1. Set ‘build mode’ to full and ‘manual mode’ to false
  2. launch server
  3. once operational run "rightimage::upload_cloud_<cloud>" recipe
  4. run "rightimage::do_create_mci" to add image to MCI
  5. launch image_tester template with newly created image
  6. launch rightlink_tester template with newly created image

== Building a RightImage (Build mode: full, Manual mode: true):

Manual mode is useful when developing of the rightimage cookbooks

  1. Set ‘build mode’ to full and ‘manual mode’ to true
  2. launch server
  3. once operational start the build using "rightimage::build_image" recipe
  4. After the build is complete run "rightimage::upload_cloud_<cloud>" recipe
  5. run "rightimage::do_create_mci" to add image to MCI
  6. launch image_tester template with newly created image
  7. launch rightlink_tester template with newly created image

== Migrating a RightImage (Build mode: migrate)

Migrate mode is used to replicate an existing image to other EC2 regions.

NOTE: Migrations are currently limited from us-west-2 (Oregon) region only.
Any RightLink-enabled image with EC2 AMI and API tools may be used to launch the instance.
An instance size of at least m1.small is required.

  1. Set ‘build mode’ to migrate
  2. Set image_name input to the name of the image to migrate
  3. Launch server in the region you wish to migrate to
  4. Once operational, start the migration using "rightimage::upload_ec2_s3" and/or "rightimage::upload_ec2_ebs" recipe

= Future Improvements

Stories to implement to for faster, simpler, lower cost MCI builds...

  As a RightImage creator
  I want to upload and register and EC2 S3 image from any region
  So I can build and bundle once and
  upload to all regions from a single VM
  instead of launching a VM, building and bundling in every region

  As a RightImage cookbook maintainer
  I want to refactor all cloud_add recipes
  So I can consolidate duplicate code into a single chef resource
  instead of every cloud_add recipe being slightly different
  
== Maintainer

email: cary@rightscale.com
